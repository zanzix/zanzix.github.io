<!DOCTYPE html>
<html lang="en">
<head profile="http://www.w3.org/2005/10/profile">
    <meta charset="UTF-8">
    <meta name="description" content="Some personal notes turned into a blog">
    <meta name="author" content="Zanzi">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@tangled_zans">
<meta name="twitter:creator" content="@tangled_zans">
<meta name="twitter:title" content="From Mendler Algebra to Relative Monads">
    <meta name="twitter:description" content="Lets start the blog">
    <meta name="twitter:image" content="https://zanzix.github.io/images/code.jpg">
    <title>From Mendler Algebra to Relative Monads</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">
</head>
<body>
    <header>
        <nav>
            <a id="beacon" href="/">
                <div id="home-text"> HOME </div>
            </a>
        </nav>
    
        <div class="right-sidebar">
            <a class="ext-link" href="https://github.com/zanzix">
            <img src="/images/github-logo.png" alt="Github Profile"/>
        </a>

            <a class="ext-link" href="https://twitter.com/tangled_zans">
            <img src="/images/twitter-logo.png" alt="Twitter Profile"/>
        </a>
    <div id="theme-button">DAY</div>
        </div>
    </header>

<div id="page">
    <div class="wrapper">
        <div class="masthead">
            <span class="title">
                From Mendler Algebra to Relative Monads
            </span>
            <br>

            <img class="post-image" src="/images/code.jpg">
            <br>
            <span class="byline">by Zanzi</span>
            <br>
            <span class="date">Aug 10, 2023</span>
            <br>
            <div class="metadata">
            </div>
            <div class="tags">
              <span class="tag functor">functor</span>
              <span class="tag fixpoint">fixpoint</span>
              <span class="tag operad">operad</span>
            </div>
        </div>
    </div>
    <article class="post">
        <p>So far we've relied on all of our underlying data-types to have a
valid instance.</p>
<p>But as we intend to generalise a <em>lot</em>, this kind of
constraint will lead to far too much boilerplate.</p>
<p>Luckily, we can generalise this away.</p>
<p>TODO: Try my trick of doing cata with no functor constraint?</p>
<p>Interestingly, we can do it in two different ways. We can either
modify our notion of algebra, as is common in the recursion-schemes
literature</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">MAlgebra</span> <span class="ot">:</span> (<span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">MAlgebra</span> f c <span class="fu">=</span> {x <span class="ot">:</span> <span class="dt">Type</span>} <span class="ot">-&gt;</span> (x <span class="ot">-&gt;</span> c) <span class="ot">-&gt;</span> f x <span class="ot">-&gt;</span> c</span></code></pre></div>
<p>Letting us keep the same type of fixpoint Mu,</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fold</span> <span class="ot">:</span> <span class="dt">MAlgebra</span> </span></code></pre></div>
<p>Or we can modify our notion of the data-type, as is more common in
the free-monad literature</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Freer</span> <span class="ot">:</span> (<span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>	<span class="dt">Var</span> <span class="ot">:</span> v <span class="ot">-&gt;</span> <span class="dt">Freerf</span> f v</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>	<span class="dt">Bind</span> <span class="ot">:</span> f x <span class="ot">-&gt;</span> (x <span class="ot">-&gt;</span> <span class="dt">Freer</span> f v) <span class="ot">-&gt;</span> <span class="dt">Freer</span> f v</span></code></pre></div>
<p>It turns out that both of these techniques are related.</p>
<p>we can look at Coyoneda,</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Coyoneda</span> <span class="ot">:</span> (<span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">InCoyo</span> <span class="ot">:</span> (a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> f a <span class="ot">-&gt;</span> <span class="dt">Coyoneda</span> f b</span></code></pre></div>
<p>we can notice that MAlgebra f a = Algebra (Coyoneda f) a</p>
<p>and we can also see that</p>
<p>Freer f a = Freer (Cyoneda f) a</p>
<p>from this, we can even derive a notion of 'freer fixpoint'</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Mu</span> <span class="ot">:</span> (<span class="kw">pattern</span> <span class="ot">:</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">-&gt;</span> <span class="dt">Type</span> <span class="kw">where</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">In</span> <span class="ot">:</span> {f<span class="ot">:</span> <span class="dt">Type</span> <span class="ot">-&gt;</span> <span class="dt">Type</span>} <span class="ot">-&gt;</span> <span class="dt">Coyoneda</span> f (<span class="dt">Mu</span> f) <span class="ot">-&gt;</span> <span class="dt">Mu</span> </span></code></pre></div>
<p>So this gives us a version of Fix and Free that does not rely on an
underlying functor instance</p>
<p>But what about Op?</p>
<p>As I mentioned in the last post, Op is not a free monad, but a free
<em>relative</em> monad.</p>
<p>The trick to deriving this is to notice that Coyoneda is a special
case of a left kan extension, Coyoneda = Lan Id, and that a standard
monad is a monad w.r.t to the Identity functor. As it turns out, these
two facts are related.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Lan</span> <span class="ot">:</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>	<span class="dt">InLan</span></span></code></pre></div>
<p>so given a context functor j : (k-&gt;Type), the free relative monad
over j is given by</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode idr"><code class="sourceCode idris"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Relative</span> <span class="ot">:</span> {j <span class="ot">:</span> k <span class="ot">-&gt;</span> <span class="dt">Type</span>} <span class="ot">-&gt;</span> (k <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">-&gt;</span> (k <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="ot">-&gt;</span> (k <span class="ot">-&gt;</span> <span class="dt">Type</span>) <span class="kw">where</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">PureR</span> <span class="ot">:</span> {j <span class="ot">:</span> k <span class="ot">-&gt;</span> <span class="dt">Type</span>} <span class="ot">-&gt;</span> j x <span class="ot">-&gt;</span> <span class="dt">Relative</span> j f x</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dt">ThenR</span> <span class="ot">:</span> {j <span class="ot">:</span> k <span class="ot">-&gt;</span> <span class="dt">Type</span>} <span class="ot">-&gt;</span> f x <span class="ot">-&gt;</span> (j x <span class="ot">-&gt;</span> <span class="dt">Relative</span> j f a) <span class="ot">-&gt;</span> <span class="dt">Relative</span> j f a</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Bind</span> <span class="ot">:</span> <span class="dt">Lan</span> j f (<span class="dt">Mu</span> j f v) <span class="ot">-&gt;</span> <span class="dt">Mu</span> j f v</span></code></pre></div>
<p>our evaluator now uses a new algebra and a new data-type</p>
<pre><code>cata : {j : k -&gt; Type} -&gt; (j n -&gt; c) -&gt; Algebra (Lan j f) c -&gt; Mu j f n -&gt; c
cata g alg = go where

go : Mu j f n -&gt; c

go (Var a) = g a

go (Bind $ MkLan continue action) = alg (MkLan (go . continue) action)</code></pre>
<p>TODO: Will this work with last post's notion of operad (Type -&gt;
Type) -&gt; (Nat -&gt; Type -&gt; Type) ?</p>
<p>LetF : f (Operad f (S n) a) -&gt; Operad f n a LetF : Coyoneda f
(Operad f (S n) a) -&gt; Operad f n a</p>
<p>LetBind : f a -&gt; Operad f (S n) a -&gt; Operad f n a)</p>

        <br>
        <br>

        <!--Share buttons-->
        <div class="social-buttons">
            <a href="https://twitter.com/share" class="twitter-share-button"
                                                data-url="https://zanzix.github.io" data-text="Check out: From Mendler Algebra to Relative Monads - " data-via="tangled_zans">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            <a href="https://twitter.com/tangled_zans" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @tangled_zans</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            <div class="fb-like" data-href="" data-layout="button" data-action="like" data-show-faces="true" data-share="true"></div>
        </div>
</article>

</div>

<footer>
    Built with Haskell using <a href="https://github.com/ChrisPenner/slick">slick</a> ❤️
</footer>

<link href='https://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
<script src="/js/main.js"></script>
</body>
</html>
